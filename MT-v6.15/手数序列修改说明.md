# MT-v6.15 手数序列修改说明

## 修改时间
2025-10-22

## 修改内容

### 1. 新手数序列逻辑
修改了加仓手数的计算逻辑，采用全新的手数序列：

| 订单序号 | 手数 | 计算方式 |
|---------|------|---------|
| 第1单 | 0.03 | 固定值 |
| 第2单 | 0.02 | 固定值 |
| 第3单 | 0.04 | 固定值 |
| 第4单 | 0.08 | 固定值 |
| 第5单 | 0.16 | 第4单 × 2 |
| 第6单 | 0.32 | 第5单 × 2 |
| 第7单 | 0.64 | 第6单 × 2 |
| 第8单 | 1.28 | 第7单 × 2 |

**特点说明：**
- 前4单采用固定手数值
- 从第5单开始，每单手数是前一单的2倍
- 最大加仓单数从9单改为8单

### 2. 代码修改详情

#### 2.1 修改基础参数（第22-26行）
```mql5
input double   InitialLot         = 0.03;     // 初始手数（第一单）
input double   MartingaleMultiplier = 2.0;    // 马丁倍数（第3单起生效）
input int      DefaultStepPoints  = 100;      // 默认加仓间距（点数）
input int      MaxOrders          = 8;        // 最大订单数
```

#### 2.2 新增手数计算函数（第1498-1542行）
添加了 `CalculateOrderVolume(int orderNum)` 函数，用于计算每个订单序号对应的手数。

**函数特点：**
- 输入：订单序号（1-8）
- 输出：该序号对应的标准化手数（保留2位小数）
- 超出范围时返回InitialLot并记录警告日志

#### 2.3 修改单边趋势策略（第1270-1304行）
在 `ExecuteSingleTrendStrategy()` 函数中：
- 将原来的 `double newVol = NormalizeDouble(maxVol * MartingaleMultiplier, 2);`
- 改为 `double newVol = CalculateOrderVolume(totalBuyOrders + 1);` （多单）
- 改为 `double newVol = CalculateOrderVolume(totalSellOrders + 1);` （空单）

#### 2.4 修改对冲策略（第1309-1346行）
在 `ExecuteHedgeStrategy()` 函数中：
- 多单和空单加仓都使用 `CalculateOrderVolume()` 函数计算手数
- 确保双边对冲时，每边的手数序列都遵循新规则

#### 2.5 修改第一单开仓（第1157-1190行）
在 `OpenFirstOrder()` 函数中：
- 添加 `double firstVolume = CalculateOrderVolume(1);`
- 使用计算出的手数而不是直接使用InitialLot

#### 2.6 修改评估开仓（第1195-1240行）
在 `EvaluateAndOpen()` 函数中：
- 同样使用 `CalculateOrderVolume(1)` 来计算第一单手数

### 3. 手数序列对比

#### 旧序列（马丁倍数2.0）：
```
0.01 → 0.02 → 0.04 → 0.08 → 0.16 → 0.32 → 0.64 → 1.28 → 2.56
```

#### 新序列：
```
0.03 → 0.02 → 0.04 → 0.08 → 0.16 → 0.32 → 0.64 → 1.28
```

**对比分析：**
- 第1单从0.01增加到0.03（增加200%）
- 第2单保持0.02不变
- 第3单起与旧序列一致
- 最大单数减少1单（从9单到8单）
- 累计手数：新序列2.57手 vs 旧序列5.11手

### 4. 风险与收益分析

#### 优势：
1. **首单增强**：第一单手数增加到0.03，提高初始盈利能力
2. **总持仓减少**：最大累计持仓从5.11手降至2.57手，降低约50%
3. **资金效率**：前期手数较大，利于快速回本
4. **风险可控**：总手数降低，爆仓风险显著下降

#### 注意事项：
1. 第一单手数增大，需要确保账户余额充足
2. 第二单手数较小（0.02），需要评估是否符合策略逻辑
3. 最大8单限制，需要配合合适的加仓间距

### 5. 建议配置

#### 最小账户余额建议：
- 杠杆500倍：建议至少 $500（安全 $1000+）
- 杠杆200倍：建议至少 $1000（安全 $2000+）
- 杠杆100倍：建议至少 $2000（安全 $5000+）

#### 加仓间距建议：
- 高波动市场（黄金）：150-200点
- 中等波动市场（欧美）：100-150点
- 低波动市场：80-120点

### 6. 测试建议

在实盘使用前，建议进行充分测试：

1. **模拟账户测试**：
   - 测试至少1个月
   - 观察最大回撤和资金曲线
   - 验证手数序列是否正确执行

2. **极端行情测试**：
   - 测试连续8单场景
   - 验证资金使用率
   - 检查是否触发保证金预警

3. **策略组合测试**：
   - 单边趋势模式
   - 双边对冲模式
   - 快速加仓场景

### 7. 版本标识

修改后的EA版本可标识为：**MT-v6.15-CustomLots**

文件名：`AdvancedMartingale_EA_v6.15.mq5`

---

## 技术支持

如有问题或需要进一步优化，请参考以下文件：
- `README.md` - 系统说明
- `快速开始.txt` - 快速入门指南
- `版本更新说明.md` - 历史版本更新记录

## 修改记录

| 日期 | 修改内容 | 修改人 |
|------|---------|--------|
| 2025-10-22 | 实现新手数序列逻辑 | AI Assistant |

---

**重要提示**：本修改已通过编译测试，但强烈建议在模拟账户充分测试后再用于实盘交易。


