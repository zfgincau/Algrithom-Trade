# AdvancedMartingale EA v6.15 使用说明

## 版本信息
- **版本号**: v6.15
- **基于**: v6.141_fixsleepbug3
- **发布日期**: 2025-10-21

## 新功能概述

### 1. 趋势反转识别算法 ✨
- **功能**: 识别市场趋势反转信号，结合传统趋势判断
- **实现方式**: 
  - K线形态反转检测 (权重30%)
  - 成交量背离检测 (权重20%)
  - 动量指标背离检测 (权重25%)
  - 超买超卖检测 (权重25%)
- **决策逻辑**:
  - 优先使用反转信号（可信度>0.7）
  - 其次使用趋势判断（可信度>0.5）
  - 两者结合确定首单方向
- **参数**:
  - `EnableReversal`: 启用趋势反转识别 (默认true)
  - `ReversalThreshold`: 反转信号阈值 (默认0.7)

### 2. 智能手数系统 💰
- **功能**: 优化的手数进程，前三单特殊设置
- **手数序列**:
  - 第1单: 0.03手
  - 第2单: 0.02手
  - 第3单: 0.04手
  - 第4单: 0.08手
  - 第5单及之后: 前一单的2倍
- **优势**: 初始风险更小，后期加倍效果更好

### 3. 防单边10000点机制 🛡️
- **功能**: 防止极端单边行情造成巨大亏损
- **触发条件**:
  - 已开8单或更多
  - 价格继续单边移动超过250点
- **执行动作**:
  - 反向开仓（手数为第8单的2倍）
  - 盈利达到30美元立即全局平仓
  - 休眠15分钟
- **参数**:
  - `EnableAntiExtremeMove`: 启用防单边机制 (默认true)
  - `AntiExtremeStartOrder`: 触发订单数 (默认8)
  - `AntiExtremePoints`: 触发点数 (默认250)
  - `AntiExtremeProfitTarget`: 盈利目标美元 (默认30.0)

### 4. 临时止盈机制 🎯
- **功能**: 快速止盈新加仓单，降低风险
- **触发条件** (基于加仓间隔的百分比):
  - 1分钟内盈利≥加仓间隔的40%，或
  - 3分钟内盈利≥加仓间隔的60%
- **智能特性**:
  - 加仓间隔200点 → 1分钟盈利80点触发，3分钟盈利120点触发
  - 加仓间隔500点 → 1分钟盈利200点触发，3分钟盈利300点触发
  - 自适应调整，更符合市场波动
- **执行动作**:
  - 平仓该单并记录盈利
  - 盈利金额冲减当前轮盈利目标
  - 重新计算加仓间隔
  - 根据实时间隔与当前距离对比决定加仓时机
- **重新加仓逻辑**:
  - 如果 新间隔 > 当前距离 → 等待价格继续移动
  - 如果 新间隔 ≤ 当前距离 → 立即按当前价格加仓
- **参数**:
  - `EnableTempTakeProfit`: 启用临时止盈 (默认true)
  - `TempTP_1MinPercent`: 1分钟盈利百分比 (默认40%)
  - `TempTP_3MinPercent`: 3分钟盈利百分比 (默认60%)

### 5. 逆向单边趋势加速检测 🚀
- **功能**: 检测逆着本轮开单方向的单边趋势加速，放大加仓间隔
- **触发条件**: 
  - 计算的加仓间隔<200点
  - 过去5分钟有明显趋势（≥50点）
  - 趋势方向逆着本轮开单方向（做多时向下，做空时向上）
  - 检测到加速（最近1分钟变化 > 平均值×1.5）
- **放大系数**: 
  - 最小1.2倍（有逆向趋势但无加速）
  - 最大2.0倍
  - 根据加速率动态计算
- **应用场景**:
  - 本轮做多，但行情加速下跌 → 放大间隔，减少加仓频率
  - 本轮做空，但行情加速上涨 → 放大间隔，减少加仓频率
- **参数**:
  - `EnableTrendAcceleration`: 启用趋势加速检测 (默认true)
  - `AccelerationLookback`: 检测回溯时间(分钟) (默认5)
  - `AccelerationMinMultiplier`: 最小放大系数 (默认1.2)
  - `AccelerationMaxMultiplier`: 最大放大系数 (默认2.0)

### 6. 超6单休眠机制 😴
- **功能**: 上一轮订单数超过6单后自动休眠
- **休眠时长**: 15分钟
- **目的**: 避免频繁进入深套局面
- **参数**:
  - `MaxOrdersBeforeSleep`: 触发休眠的订单数 (默认6)
  - `SleepAfterRoundMinutes`: 休眠时长(分钟) (默认15)

### 7. 波动系数优化 📊
- **修改内容**: 更合理的波动权重系数
- **新系数**:
  - 250点 → 1.2 (原0.7)
  - 300点 → 1.4 (原0.9)
  - 350点 → 1.6 (原1.2)
  - 400点 → 2.0 (保持不变)
- **优势**: 更好地适应市场波动

## 参数设置建议

### 保守型
```
InitialLot = 0.03
MaxOrdersBeforeSleep = 5
EnableAntiExtremeMove = true
AntiExtremeStartOrder = 7
EnableTempTakeProfit = true
```

### 平衡型 (默认)
```
InitialLot = 0.03
MaxOrdersBeforeSleep = 6
EnableAntiExtremeMove = true
AntiExtremeStartOrder = 8
EnableTempTakeProfit = true
```

### 激进型
```
InitialLot = 0.03
MaxOrdersBeforeSleep = 7
EnableAntiExtremeMove = true
AntiExtremeStartOrder = 9
EnableTempTakeProfit = false
```

## 使用流程

1. **复制EA到MT5**
   - 将 `AdvancedMartingale_EA_v6.15.mq5` 复制到 MT5的 `MQL5/Experts` 文件夹
   - 重启MT5或刷新导航器

2. **加载EA到图表**
   - 打开XAUUSD M1图表
   - 拖拽EA到图表
   - 设置参数（建议先使用默认值）

3. **启用自动交易**
   - 点击工具栏的"自动交易"按钮
   - 确认EA正在运行

4. **监控运行**
   - 观察图表左上角的EA信息显示
   - 检查日志文件 `EA_v6.15_Log.txt`
   - 关注关键指标：订单数、盈利率、间隔

## 重要提示 ⚠️

1. **资金管理**
   - 建议最小账户余额: $500
   - 建议杠杆: 500:1
   - 第一单0.03手对应约$2保证金

2. **风险控制**
   - 防单边机制会在极端情况下触发
   - 超6单后会自动休眠15分钟
   - 建议监控最大回撤

3. **参数调整**
   - 新手建议使用默认参数
   - 根据实盘表现逐步优化
   - 不要频繁修改参数

4. **回测建议**
   - 先在模拟盘测试至少2周
   - 观察各种市场情况下的表现
   - 记录关键数据用于优化

## 与v6.141的主要区别

| 功能 | v6.141 | v6.15 |
|------|---------|-------|
| 趋势反转识别 | ❌ | ✅ |
| 智能手数 | ❌ (固定初始手数) | ✅ (前三单特殊) |
| 防单边机制 | ❌ | ✅ (第8单后) |
| 临时止盈 | ❌ | ✅ (1m/3m) |
| 趋势加速检测 | ❌ | ✅ (<200点时) |
| 超6单休眠 | ❌ | ✅ (15分钟) |
| 波动系数 | 旧系数 | ✅ 优化系数 |

## 常见问题

**Q: 为什么第一单是0.03手而不是0.01手?**
A: 0.03手的初始手数配合后续的0.02、0.04手数序列，可以更好地控制风险和盈利潜力。

**Q: 防单边机制什么时候触发?**
A: 当已开8单且价格继续单边移动超过250点时触发，开反向双倍单对冲。

**Q: 临时止盈会影响正常策略吗?**
A: 不会，临时止盈只是提前兑现部分利润，之后会根据实时间隔与当前距离对比决定是否立即重新加仓。

**Q: 临时止盈后如何重新加仓?**
A: 重新计算间隔，如果间隔>当前距离则等待，如果间隔≤当前距离则立即按当前价格加仓。

**Q: 临时止盈为什么用百分比而不是固定点数?**
A: 因为加仓间隔是动态的（100-1200点），用百分比更灵活，能自适应不同的市场波动。

**Q: 趋势反转识别准确吗?**
A: 综合了4种反转信号，准确率较高，但建议结合趋势判断使用。

**Q: 逆向趋势加速检测的作用是什么?**
A: 当行情逆着开单方向加速时，放大加仓间隔，减少加仓频率，降低连续套牢的风险。

**Q: 可以禁用某些功能吗?**
A: 可以，每个功能都有对应的Enable开关参数。

## 技术支持

如有问题，请查看:
1. 日志文件: `EA_v6.15_Log.txt`
2. MT5专家日志
3. 本README文档

## 更新日志

### v6.15 (2025-10-21)
- ✨ 新增趋势反转识别算法
- ✨ 实现智能手数系统
- ✨ 添加防单边10000点机制
- ✨ 实现临时止盈功能
- ✨ 添加单边趋势加速检测
- ✨ 实现超6单休眠机制
- 🔧 优化波动系数参数
- 📝 完善日志输出

---

**免责声明**: 本EA仅供学习研究使用，实盘交易风险自负。请务必在模拟盘充分测试后再使用实盘。

