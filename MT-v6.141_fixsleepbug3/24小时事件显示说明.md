# 24小时交易事件显示功能说明

## 功能概述

EA会在图表右侧实时显示未来24小时内将要发生的交易事件，帮助您提前了解EA的休眠计划。

## 显示位置

- **左侧面板**：原有的EA状态信息（价格、模式、订单等）
- **右侧面板**：未来24小时交易事件列表

## 显示内容

未来24小时内可能出现的交易事件包括：

### 1. 每日收盘/开盘事件
- **每日收盘前20分钟休眠**：避免产生过夜费
- **每日开盘后10分钟休眠结束**：休眠结束，恢复交易

### 2. 市场盘切换事件（如果启用）
- **亚洲盘开盘前15分钟休眠**
- **欧洲盘开盘前15分钟休眠**
- **美国盘开盘前15分钟休眠**

### 3. 周末休眠事件（如果启用）
- **周五收盘休眠**：周末休眠，直到下周一开盘

## 显示格式

```
--- 📅 未来24小时交易事件 ---
04:40 每日收盘前20分钟休眠
06:10 每日开盘后10分钟休眠结束
07:45 亚洲盘开盘前15分钟休眠
14:45 欧洲盘开盘前15分钟休眠
20:15 美国盘开盘前15分钟休眠
22:00 周五收盘休眠
```

## 功能特点

1. **实时更新**：每次价格变动（OnTick）时自动更新
2. **智能过滤**：只显示未来24小时内的事件
3. **时间排序**：按时间顺序显示，最近的事件在前
4. **数量限制**：最多显示10个事件，避免显示过多内容
5. **条件显示**：只显示已启用的功能相关事件

## 如何启用/禁用

24小时事件显示功能取决于以下参数：

### 必须启用的参数
```
EnableMarketTimeControl = true  // 启用市场时间控制
```

如果这个参数为 false，则不会显示任何事件。

### 可选参数
```
NoWeekendPositions = true          // 启用周末休眠（显示周五收盘事件）
```

**注意**：市场盘切换事件（亚洲/欧洲/美国盘）总是会显示，无需额外启用。

## 调整显示位置

如果您想调整右侧面板的显示位置，可以修改代码中的以下参数：

**文件位置**：`AdvancedMartingale_EA_v6.141_fixsleepbug.mq5`  
**行号**：约1667行

```cpp
int rightStart = 50;  // 右边面板起始列
```

- 增大该值：右侧面板向右移动
- 减小该值：右侧面板向左移动

## 故障排查

### 问题1：没有显示24小时事件

**可能原因**：
1. `EnableMarketTimeControl = false` - 市场时间控制未启用
2. 未来24小时内没有交易事件

**解决方法**：
1. 在EA参数中设置 `EnableMarketTimeControl = true`
2. 检查EA启动时的日志，查看是否有 "未来24小时交易事件" 的输出

### 问题2：显示的事件不完整

**可能原因**：
1. `NoWeekendPositions = false` - 未启用周末休眠（不会显示周五收盘事件）
2. 未来24小时内确实没有其他事件

**解决方法**：
1. 如果需要周五收盘休眠提醒，设置 `NoWeekendPositions = true`
2. 检查当前时间和已设置的时间参数

### 问题3：显示位置不理想

**解决方法**：
1. 调整 `rightStart` 参数值
2. 重新编译EA
3. 重新加载EA到图表

## 调试信息

EA启动时会在专家日志中输出：
```
未来24小时交易事件: 04:40 每日收盘前20分钟休眠
06:10 每日开盘后10分钟休眠结束
...
```

您可以在 MetaTrader 5 的"专家"标签页中查看这些信息。

## 技术实现

### 相关函数
1. **`CalculateNext24hEvents()`**：计算未来24小时的交易事件
2. **`UpdateDisplay()`**：更新图表显示
3. **`OnTick()`**：每次价格变动时调用上述函数

### 更新频率
- 每次价格变动（tick）时更新
- 确保显示的信息始终是最新的

### 性能优化
- 使用结构体数组存储事件
- 限制最多显示10个事件
- 避免重复计算

## 注意事项

1. **服务器时间**：显示的时间是MT5服务器时间，可能与您的本地时间不同
2. **时区差异**：确保您设置的时间参数与服务器时区一致
3. **夏令时**：注意美国和欧洲的夏令时调整
4. **显示空间**：如果图表窗口太小，显示可能会重叠

## 示例配置

### 配置1：只启用每日休眠
```
EnableMarketTimeControl = true
NoWeekendPositions = false
```
**显示结果**：显示每日收盘/开盘事件和市场盘切换事件

### 配置2：启用所有时间控制
```
EnableMarketTimeControl = true
NoWeekendPositions = true
```
**显示结果**：显示所有交易事件（每日、市场盘切换、周末休眠）

### 配置3：完全关闭时间控制
```
EnableMarketTimeControl = false
```
**显示结果**：不显示任何事件

