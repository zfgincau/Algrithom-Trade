# MT-v6.141 ä¼‘çœ Bugä¿®å¤è¯¦ç»†è¯´æ˜Ž

## ä¸€ã€é—®é¢˜åˆ†æž

### 1.1 åŽŸç‰ˆé—®é¢˜æè¿°

åœ¨MT-v6.141ç‰ˆæœ¬ä¸­ï¼Œå½“ç¨‹åºåˆ°è¾¾ä¼‘çœ æ—¶é—´èŠ‚ç‚¹æ—¶ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

**çŽ°è±¡ï¼š**
- ç¨‹åºæ£€æµ‹åˆ°ä¼‘çœ æ¡ä»¶ï¼ˆå¦‚å‘¨äº”æ”¶ç›˜å‰ã€å¸‚åœºç›˜åˆ‡æ¢å‰ç­‰ï¼‰
- ç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“é€»è¾‘
- å·²æœ‰çš„è®¢å•æ—¢ä¸ç»§ç»­åŠ ä»“ï¼Œä¹Ÿä¸å¹³ä»“
- ç¨‹åºè¿›å…¥"å¹²è€—"çŠ¶æ€ï¼Œç­‰å¾…ä¼‘çœ æ—¶é—´ç»“æŸ

**åŽŸä»£ç é€»è¾‘ï¼ˆç®€åŒ–ï¼‰ï¼š**
```cpp
void OnTick()
{
    // æ£€æŸ¥ä¼‘çœ çŠ¶æ€
    if(isSleeping)
    {
        return;  // ç›´æŽ¥é€€å‡ºï¼Œä¸æ‰§è¡Œä»»ä½•é€»è¾‘
    }
    
    // æ£€æŸ¥æ—¶é—´é£Žé™©
    if(!CheckTimeRisk())
    {
        isSleeping = true;
        return;  // è¿›å…¥ä¼‘çœ ï¼Œç«‹å³é€€å‡º
    }
    
    // ... åŽç»­äº¤æ˜“é€»è¾‘
    
    // é©¬ä¸å’Œå¯¹å†²é€»è¾‘
    if(martingaleEnabled && firstOrderOpened && totalOrders > 0 && !isSleeping)
    {
        ExecuteStrategy();  // ä¼‘çœ æ—¶ä¸æ‰§è¡Œ
    }
}
```

**é—®é¢˜æ ¹æºï¼š**
1. ä¼‘çœ æ£€æŸ¥ç›´æŽ¥`return`ï¼Œå¯¼è‡´æ‰€æœ‰åŽç»­é€»è¾‘ä¸æ‰§è¡Œ
2. é©¬ä¸é€»è¾‘åˆ¤æ–­åŒ…å«`!isSleeping`ï¼Œå¯¼è‡´ä¼‘çœ æ—¶ä¸åŠ ä»“
3. æ²¡æœ‰åŒºåˆ†"æœ‰æŒä»“çš„ä¼‘çœ "å’Œ"æ— æŒä»“çš„ä¼‘çœ "
4. å¹³ä»“åŽå¯èƒ½è‡ªåŠ¨å¼€æ–°å•ï¼Œæ²¡æœ‰è€ƒè™‘ä¼‘çœ çŠ¶æ€

### 1.2 ç”¨æˆ·éœ€æ±‚åˆ†æž

ç”¨æˆ·å¸Œæœ›çš„æ­£ç¡®è¡Œä¸ºï¼š

**åˆ°è¾¾ä¼‘çœ æ—¶é—´åŽï¼š**

1. **å½“å‰è½®ç»§ç»­äº¤æ˜“**
   - âœ… ç»§ç»­è®¡ç®—åŠ¨æ€åŠ ä»“é—´éš”
   - âœ… ç»§ç»­è®¡ç®—ç›ˆåˆ©çŽ‡ç›®æ ‡
   - âœ… è§¦å‘æ¡ä»¶æ—¶æ­£å¸¸ä¸‹å•åŠ ä»“
   - âœ… ç»§ç»­ç›‘æŽ§ç›ˆåˆ©ç›®æ ‡

2. **å½“å‰è½®å®ŒæˆåŽåœæ­¢**
   - âœ… è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡åŽè‡ªåŠ¨å¹³ä»“
   - âœ… å¹³ä»“åŽä¸å†å¼€å§‹æ–°ä¸€è½®äº¤æ˜“
   - âœ… ä¿æŒä¼‘çœ çŠ¶æ€ç›´åˆ°æ—¶é—´ç»“æŸ

3. **å®žæ—¶è®¡ç®—ç»§ç»­**
   - âœ… æ³¢åŠ¨çŽ‡è®¡ç®—ç»§ç»­å·¥ä½œ
   - âœ… æŠ€æœ¯æŒ‡æ ‡å®žæ—¶æ›´æ–°
   - âœ… ATRç­‰æŒ‡æ ‡æ­£å¸¸è®¡ç®—

4. **å›¾è¡¨æ˜¾ç¤ºå¢žå¼º**
   - âœ… æ˜¾ç¤ºä¼‘çœ é¢„è­¦ï¼ˆæå‰60åˆ†é’Ÿï¼‰
   - âœ… æ˜¾ç¤ºä¼‘çœ åŽŸå› å’Œå€’è®¡æ—¶
   - âœ… æ˜¾ç¤ºå½“å‰è½®äº¤æ˜“çŠ¶æ€
   - âœ… æ˜¾ç¤ºäº¤æ˜“ç›˜åˆ‡æ¢ä¿¡æ¯

## äºŒã€ä¿®å¤æ–¹æ¡ˆ

### 2.1 æ ¸å¿ƒä¿®å¤æ€è·¯

**å…³é”®åŽŸåˆ™ï¼š**
> ä¼‘çœ åªé˜»æ­¢å¼€æ–°çš„ç¬¬ä¸€å•ï¼Œä¸é˜»æ­¢å½“å‰è½®çš„åŠ ä»“å’Œå¹³ä»“

**å®žçŽ°ç­–ç•¥ï¼š**
1. ä¼‘çœ æ£€æŸ¥ä¸ç›´æŽ¥`return`ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œ
2. åªåœ¨å¼€ç¬¬ä¸€å•æ—¶æ£€æŸ¥ä¼‘çœ çŠ¶æ€
3. é©¬ä¸é€»è¾‘ä¸æ£€æŸ¥ä¼‘çœ çŠ¶æ€
4. å¹³ä»“åŽæ£€æŸ¥ä¼‘çœ çŠ¶æ€ï¼Œå†³å®šæ˜¯å¦å¼€æ–°å•

### 2.2 ä»£ç ä¿®æ”¹è¯¦è§£

#### ä¿®æ”¹1ï¼šOnTickå‡½æ•°å¼€å¤´çš„ä¼‘çœ æ£€æŸ¥

**åŽŸä»£ç ï¼š**
```cpp
void OnTick()
{
    if(isSleeping)
    {
        // å¤„ç†æ‰‹åŠ¨ä¼‘çœ ï¼šç­‰å¾…å½“å‰è½®äº¤æ˜“ç»“æŸ
        if(sleepReason == "æ‰‹åŠ¨ä¼‘çœ " && totalOrders > 0)
        {
            return;  // ç›´æŽ¥é€€å‡º
        }
        
        // æ£€æŸ¥ä¼‘çœ æ—¶é—´æ˜¯å¦ç»“æŸ
        if(sleepEndTime > 0 && TimeCurrent() >= sleepEndTime)
        {
            // è§£é™¤ä¼‘çœ 
            isSleeping = false;
        }
        else if(sleepEndTime == 0)
        {
            return;  // æ‰‹åŠ¨ä¼‘çœ ï¼Œç›´æŽ¥é€€å‡º
        }
        else
        {
            return;  // ä»åœ¨ä¼‘çœ ï¼Œç›´æŽ¥é€€å‡º
        }
    }
}
```

**ä¿®æ”¹åŽï¼š**
```cpp
void OnTick()
{
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¼˜å…ˆçº§1: æ‰‹åŠ¨ä¼‘çœ æ£€æŸ¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    if(isSleeping)
    {
        // æ£€æŸ¥ä¼‘çœ æ—¶é—´æ˜¯å¦ç»“æŸï¼ˆä»…å¯¹è‡ªåŠ¨ä¼‘çœ æœ‰æ•ˆï¼‰
        if(sleepEndTime > 0 && TimeCurrent() >= sleepEndTime)
        {
            WriteLog("ä¼‘çœ ç»“æŸ,è‡ªåŠ¨æ¢å¤äº¤æ˜“: " + sleepReason);
            isSleeping = false;
            sleepReason = "";
            sleepStartTime = 0;
            sleepEndTime = 0;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            ObjectSetString(0, btnWakeUp, OBJPROP_TEXT, "ä¼‘çœ ");
        }
        else if(sleepEndTime == 0 && totalOrders == 0)
        {
            // æ‰‹åŠ¨ä¼‘çœ ä¸”æ— æŒä»“ï¼Œéœ€è¦æ‰‹åŠ¨å”¤é†’ï¼Œä¸æ‰§è¡Œä»»ä½•é€»è¾‘
            return;  // åªæœ‰è¿™ç§æƒ…å†µæ‰return
        }
        // ã€å…³é”®ä¿®æ”¹ã€‘å¦‚æžœå¤„äºŽä¼‘çœ çŠ¶æ€ä½†æœ‰æŒä»“ï¼Œç»§ç»­æ‰§è¡ŒåŽç»­é€»è¾‘ï¼Œè®©å½“å‰è½®æ­£å¸¸äº¤æ˜“
        // åªæ˜¯é˜»æ­¢å¼€æ–°çš„ç¬¬ä¸€å•
    }
    // ... ç»§ç»­æ‰§è¡ŒåŽç»­é€»è¾‘
}
```

**ä¿®æ”¹è¯´æ˜Žï¼š**
- åªæœ‰åœ¨"æ‰‹åŠ¨ä¼‘çœ ä¸”æ— æŒä»“"æ—¶æ‰`return`
- å¦‚æžœæœ‰æŒä»“ï¼Œå³ä½¿ä¼‘çœ ä¹Ÿç»§ç»­æ‰§è¡ŒåŽç»­é€»è¾‘
- è¿™æ ·å¯ä»¥è®©å½“å‰è½®æ­£å¸¸å®Œæˆ

#### ä¿®æ”¹2ï¼šæ—¶é—´é£Žé™©æŽ§åˆ¶æ£€æŸ¥

**åŽŸä»£ç ï¼š**
```cpp
if(EnableTimeControl && !CheckTimeRisk())
{
    if(!isSleeping)
    {
        isSleeping = true;
        sleepReason = noTradeReason;
        sleepStartTime = TimeCurrent();
        sleepEndTime = CalculateSleepEndTime(noTradeReason);
        WriteLog("è¿›å…¥ä¼‘çœ çŠ¶æ€: " + sleepReason);
        WriteLog("ç­‰å¾…å½“å‰è½®äº¤æ˜“è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡åŽå¹³ä»“ï¼Œä¸å†å¼€æ–°å•");
        
        ObjectSetString(0, btnWakeUp, OBJPROP_TEXT, "å”¤é†’");
    }
    
    // ä¼‘çœ çŠ¶æ€ä¸‹ä¸å¼ºåˆ¶å¹³ä»“ï¼Œç­‰å¾…å½“å‰è½®è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡
    // åªé˜»æ­¢å¼€æ–°å•ï¼Œè®©å½“å‰è½®è‡ªç„¶ç»“æŸ
    return;  // ç›´æŽ¥é€€å‡º
}
```

**ä¿®æ”¹åŽï¼š**
```cpp
if(EnableTimeControl && !CheckTimeRisk())
{
    if(!isSleeping)
    {
        isSleeping = true;
        sleepReason = noTradeReason;
        sleepStartTime = TimeCurrent();
        sleepEndTime = CalculateSleepEndTime(noTradeReason);
        WriteLog("è¿›å…¥ä¼‘çœ çŠ¶æ€: " + sleepReason);
        WriteLog("ã€é‡è¦ã€‘å½“å‰è½®äº¤æ˜“å°†ç»§ç»­æ­£å¸¸æ‰§è¡Œï¼ˆè®¡ç®—åŠ ä»“é—´éš”ã€ç›ˆåˆ©çŽ‡ç›®æ ‡ã€æ‰§è¡ŒåŠ ä»“ï¼‰");
        WriteLog("ã€é‡è¦ã€‘å½“å‰è½®è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡å¹³ä»“åŽï¼Œå°†ä¸å†å¼€å§‹æ–°ä¸€è½®äº¤æ˜“");
        
        ObjectSetString(0, btnWakeUp, OBJPROP_TEXT, "å”¤é†’");
    }
    
    // ã€å…³é”®ä¿®æ”¹ã€‘ä¸å†ç›´æŽ¥returnï¼Œè®©åŽç»­é€»è¾‘ç»§ç»­æ‰§è¡Œ
    // ä¼‘çœ çŠ¶æ€åªé˜»æ­¢å¼€æ–°çš„ç¬¬ä¸€å•ï¼Œä¸é˜»æ­¢å½“å‰è½®çš„åŠ ä»“å’Œå¹³ä»“
}
```

**ä¿®æ”¹è¯´æ˜Žï¼š**
- åˆ é™¤äº†`return`è¯­å¥
- ç¨‹åºç»§ç»­å‘ä¸‹æ‰§è¡Œ
- æ—¥å¿—æ›´æ–°ä¸ºæ˜Žç¡®è¯´æ˜Žå½“å‰è½®ç»§ç»­äº¤æ˜“

#### ä¿®æ”¹3ï¼šæžç«¯è¡Œæƒ…æ£€æµ‹

**åŽŸä»£ç ï¼š**
```cpp
if(EnableExtremePrevention && CheckExtremeMarket())
{
    if(!tradingPaused)
    {
        // ... è®¾ç½®ä¼‘çœ çŠ¶æ€
    }
    return;  // ç›´æŽ¥é€€å‡º
}
```

**ä¿®æ”¹åŽï¼š**
```cpp
if(EnableExtremePrevention && CheckExtremeMarket())
{
    if(!tradingPaused)
    {
        // ... è®¾ç½®ä¼‘çœ çŠ¶æ€
        WriteLog("ã€é‡è¦ã€‘å½“å‰è½®äº¤æ˜“å°†ç»§ç»­æ­£å¸¸æ‰§è¡Œï¼ˆè®¡ç®—åŠ ä»“é—´éš”ã€ç›ˆåˆ©çŽ‡ç›®æ ‡ã€æ‰§è¡ŒåŠ ä»“ï¼‰");
        WriteLog("ã€é‡è¦ã€‘å½“å‰è½®è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡å¹³ä»“åŽï¼Œå°†ä¸å†å¼€å§‹æ–°ä¸€è½®äº¤æ˜“");
    }
    // ã€å…³é”®ä¿®æ”¹ã€‘ä¸å†ç›´æŽ¥returnï¼Œç»§ç»­æ‰§è¡ŒåŽç»­é€»è¾‘
    // è®©å½“å‰è½®äº¤æ˜“æ­£å¸¸å®Œæˆ
}
```

**ä¿®æ”¹è¯´æ˜Žï¼š**
- åˆ é™¤`return`è¯­å¥
- æžç«¯è¡Œæƒ…æ£€æµ‹ä¸å†é˜»æ­¢å½“å‰è½®äº¤æ˜“

#### ä¿®æ”¹4ï¼šé©¬ä¸å’Œå¯¹å†²é€»è¾‘æ‰§è¡Œæ¡ä»¶

**åŽŸä»£ç ï¼š**
```cpp
// é©¬ä¸å’Œå¯¹å†²é€»è¾‘ï¼ˆä¼‘çœ çŠ¶æ€ä¸‹ä¸è¿›è¡Œæ–°çš„åŠ ä»“ï¼‰
if(martingaleEnabled && firstOrderOpened && totalOrders > 0 && !tradingPaused && !isSleeping)
{
    ExecuteStrategy();
}
```

**ä¿®æ”¹åŽï¼š**
```cpp
// ã€æ ¸å¿ƒä¿®æ”¹ã€‘é©¬ä¸å’Œå¯¹å†²é€»è¾‘
// ä¼‘çœ çŠ¶æ€ä¸‹ï¼Œå¦‚æžœæœ‰æŒä»“ï¼Œç»§ç»­æ‰§è¡Œç­–ç•¥ï¼ˆåŠ ä»“é€»è¾‘ï¼‰
// åªæœ‰åœ¨æ²¡æœ‰æŒä»“æ—¶æ‰çœŸæ­£åœæ­¢
if(martingaleEnabled && firstOrderOpened && totalOrders > 0)
{
    // ä¼‘çœ çŠ¶æ€ä¸‹ä¹Ÿæ‰§è¡Œç­–ç•¥ï¼Œè®©å½“å‰è½®æ­£å¸¸å®Œæˆ
    ExecuteStrategy();
}
```

**ä¿®æ”¹è¯´æ˜Žï¼š**
- åˆ é™¤äº†`!tradingPaused`å’Œ`!isSleeping`æ¡ä»¶
- åªè¦æœ‰æŒä»“å°±æ‰§è¡Œç­–ç•¥
- è¿™æ˜¯è®©å½“å‰è½®ç»§ç»­äº¤æ˜“çš„æ ¸å¿ƒ

#### ä¿®æ”¹5ï¼šå¹³ä»“åŽçš„é€»è¾‘

**åŽŸä»£ç ï¼š**
```cpp
CloseAllOrders();
Sleep(2000);

// å¦‚æžœå¤„äºŽä¼‘çœ çŠ¶æ€ï¼Œè¾¾åˆ°ç›ˆåˆ©ç›®æ ‡åŽç»“æŸä¼‘çœ 
if(isSleeping)
{
    WriteLog("ä¼‘çœ çŠ¶æ€ä¸‹è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡ï¼Œå¹³ä»“åŽç»“æŸä¼‘çœ ");
    isSleeping = false;  // ç›´æŽ¥ç»“æŸä¼‘çœ 
    sleepReason = "";
    sleepStartTime = 0;
    sleepEndTime = 0;
    tradingPaused = false;
    extremeDetected = false;
    noTradeReason = "";
    
    ObjectSetString(0, btnWakeUp, OBJPROP_TEXT, "ä¼‘çœ ");
    UpdateModeButton();
    
    WriteLog("ä¼‘çœ ç»“æŸï¼Œç­‰å¾…æ‰‹åŠ¨å”¤é†’æˆ–è‡ªåŠ¨å¼€å•");
}

if(autoOpenEnabled && !tradingPaused && !isSleeping)
{
    WriteLog("è‡ªåŠ¨å¼€å•å·²å¯ç”¨ï¼Œé‡æ–°è¯„ä¼°...");
    if(EvaluateAndOpen())
    {
        WriteLog("æ–°è½®æ¬¡å¼€å§‹");
    }
}
else
{
    firstOrderOpened = false;
}
```

**ä¿®æ”¹åŽï¼š**
```cpp
CloseAllOrders();
Sleep(2000);

// ã€æ ¸å¿ƒä¿®æ”¹ã€‘å¦‚æžœå¤„äºŽä¼‘çœ çŠ¶æ€ï¼Œè¾¾åˆ°ç›ˆåˆ©ç›®æ ‡åŽä¸å†å¼€æ–°å•
// ä¿æŒä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°ä¼‘çœ æ—¶é—´ç»“æŸæˆ–æ‰‹åŠ¨å”¤é†’
if(isSleeping)
{
    WriteLog("ä¼‘çœ çŠ¶æ€ä¸‹è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡ï¼Œå·²å¹³ä»“");
    WriteLog("ã€é‡è¦ã€‘ä¿æŒä¼‘çœ çŠ¶æ€ï¼Œä¸å†å¼€å§‹æ–°ä¸€è½®äº¤æ˜“");
    WriteLog("ä¼‘çœ åŽŸå› : " + sleepReason);
    if(sleepEndTime > 0)
    {
        int remainingMinutes = (int)(sleepEndTime - TimeCurrent()) / 60;
        WriteLog("é¢„è®¡ä¼‘çœ ç»“æŸæ—¶é—´: " + TimeToString(sleepEndTime) + " (å‰©ä½™çº¦" + IntegerToString(remainingMinutes) + "åˆ†é’Ÿ)");
    }
    else
    {
        WriteLog("æ‰‹åŠ¨ä¼‘çœ ï¼Œéœ€è¦æ‰‹åŠ¨å”¤é†’æ‰èƒ½ç»§ç»­äº¤æ˜“");
    }
    
    // é‡ç½®æ ‡å¿—ï¼Œä½†ä¿æŒä¼‘çœ çŠ¶æ€
    firstOrderOpened = false;
}
else
{
    // éžä¼‘çœ çŠ¶æ€ï¼Œæ­£å¸¸è‡ªåŠ¨å¼€å•
    if(autoOpenEnabled && !tradingPaused)
    {
        WriteLog("è‡ªåŠ¨å¼€å•å·²å¯ç”¨ï¼Œé‡æ–°è¯„ä¼°...");
        if(EvaluateAndOpen())
        {
            WriteLog("æ–°è½®æ¬¡å¼€å§‹");
        }
    }
    else
    {
        firstOrderOpened = false;
    }
}
```

**ä¿®æ”¹è¯´æ˜Žï¼š**
- ä¼‘çœ çŠ¶æ€ä¸‹å¹³ä»“åŽ**ä¸å†è§£é™¤ä¼‘çœ **
- ä¿æŒä¼‘çœ çŠ¶æ€ï¼Œä¸å¼€æ–°å•
- æ—¥å¿—æ˜Žç¡®è®°å½•å‰©ä½™ä¼‘çœ æ—¶é—´
- éžä¼‘çœ çŠ¶æ€æ‰è‡ªåŠ¨å¼€æ–°å•

### 2.3 æ–°å¢žåŠŸèƒ½

#### æ–°å¢ž1ï¼šä¼‘çœ é¢„è­¦åŠŸèƒ½

**æ–°å¢žå‡½æ•°ï¼š**
```cpp
void CalculateNextSleepTime()
{
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    datetime currentTime = TimeCurrent();
    int currentMinutes = dt.hour * 60 + dt.min;
    
    datetime nearestSleepTime = 0;
    string nearestReason = "";
    
    // æ£€æŸ¥å„ç§ä¼‘çœ è§¦å‘æ¡ä»¶
    // 1. å‘¨äº”æ”¶ç›˜
    // 2. æ¯æ—¥æ”¶ç›˜å‰
    // 3. äºšæ´²ç›˜å¼€ç›˜å‰
    // 4. æ¬§æ´²ç›˜å¼€ç›˜å‰
    // 5. ç¾Žå›½ç›˜å¼€ç›˜å‰
    
    // æ‰¾å‡ºæœ€è¿‘çš„ä¼‘çœ æ—¶é—´
    nextSleepTime = nearestSleepTime;
    nextSleepReason = nearestReason;
}
```

**è°ƒç”¨ä½ç½®ï¼š**
```cpp
void OnTick()
{
    CountOrders();
    
    // ã€æ–°å¢žã€‘è®¡ç®—ä¸‹æ¬¡ä¼‘çœ æ—¶é—´ï¼ˆé¢„è­¦åŠŸèƒ½ï¼‰
    if(!isSleeping)
    {
        CalculateNextSleepTime();
    }
    
    // ... åŽç»­é€»è¾‘
}
```

**åŠŸèƒ½è¯´æ˜Žï¼š**
- å®žæ—¶è®¡ç®—ä¸‹æ¬¡ä¼‘çœ æ—¶é—´
- è®¡ç®—è§¦å‘ä¼‘çœ çš„åŽŸå› 
- åœ¨è·ç¦»ä¼‘çœ 60åˆ†é’Ÿå†…æ˜¾ç¤ºé¢„è­¦

#### æ–°å¢ž2ï¼šäº¤æ˜“ç›˜ä¿¡æ¯æ˜¾ç¤º

**æ–°å¢žå‡½æ•°ï¼š**
```cpp
string GetNextTradingSession()
{
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    int currentHour = dt.hour;
    
    // åˆ¤æ–­å½“å‰åœ¨å“ªä¸ªç›˜
    string currentSession = "";
    string nextSession = "";
    datetime nextSessionTime = 0;
    
    if(currentHour >= 6 && currentHour < 15)
    {
        currentSession = "äºšæ´²ç›˜";
        nextSession = "æ¬§æ´²ç›˜";
        // ... è®¡ç®—ä¸‹æ¬¡ç›˜å¼€ç›˜æ—¶é—´
    }
    else if(currentHour >= 15 && currentHour < 20)
    {
        currentSession = "æ¬§æ´²ç›˜";
        nextSession = "ç¾Žå›½ç›˜";
        // ... è®¡ç®—ä¸‹æ¬¡ç›˜å¼€ç›˜æ—¶é—´
    }
    else
    {
        currentSession = "ç¾Žå›½ç›˜";
        nextSession = "äºšæ´²ç›˜";
        // ... è®¡ç®—ä¸‹æ¬¡ç›˜å¼€ç›˜æ—¶é—´
    }
    
    // è®¡ç®—å€’è®¡æ—¶
    int minutesUntilNext = (int)(nextSessionTime - TimeCurrent()) / 60;
    int hoursUntilNext = minutesUntilNext / 60;
    int remainingMinutes = minutesUntilNext % 60;
    
    // æ ¼å¼åŒ–è¾“å‡º
    string result = currentSession;
    if(isSleeping)
    {
        result += " (ä¼‘çœ ä¸­)";
    }
    result += " â†’ " + nextSession;
    if(hoursUntilNext > 0)
        result += StringFormat(" (%dæ—¶%dåˆ†åŽ)", hoursUntilNext, remainingMinutes);
    else
        result += StringFormat(" (%dåˆ†åŽ)", remainingMinutes);
    
    return result;
}
```

**åŠŸèƒ½è¯´æ˜Žï¼š**
- æ˜¾ç¤ºå½“å‰å¸‚åœºç›˜ï¼ˆäºšæ´²/æ¬§æ´²/ç¾Žæ´²ï¼‰
- æ˜¾ç¤ºä¸‹æ¬¡äº¤æ˜“ç›˜åç§°
- æ˜¾ç¤ºè·ç¦»ä¸‹æ¬¡ç›˜å¼€ç›˜çš„å€’è®¡æ—¶
- ä¼‘çœ æ—¶æ ‡æ³¨"(ä¼‘çœ ä¸­)"

#### æ–°å¢ž3ï¼šå¢žå¼ºçš„å›¾è¡¨æ˜¾ç¤º

**ä¿®æ”¹UpdateDisplayå‡½æ•°ï¼š**
```cpp
void UpdateDisplay(double profit, double marginProfitRate, double targetMarginRate)
{
    // ... åŸºç¡€ä¿¡æ¯æ˜¾ç¤º
    
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ˜¾ç¤ºä¼‘çœ çŠ¶æ€å’Œé¢„è­¦ä¿¡æ¯
    if(isSleeping)
    {
        // ä¼‘çœ çŠ¶æ€æ˜¾ç¤º
        displayText += StringFormat("\n--- ðŸ’¤ ä¼‘çœ çŠ¶æ€ ---\n");
        displayText += StringFormat("åŽŸå› : %s\n", sleepReason);
        
        if(totalOrders > 0)
        {
            displayText += "ã€å½“å‰è½®ç»§ç»­äº¤æ˜“ä¸­ã€‘\n";
            displayText += "æ­£å¸¸è®¡ç®—åŠ ä»“é—´éš”å’Œç›ˆåˆ©çŽ‡\n";
            displayText += "è¾¾åˆ°ç›®æ ‡åŽå¹³ä»“ä¸å†å¼€æ–°å•\n";
        }
        else
        {
            displayText += "æ— æŒä»“ï¼Œç­‰å¾…ä¼‘çœ ç»“æŸ\n";
        }
        
        if(sleepEndTime > 0)
        {
            int remainingSeconds = (int)(sleepEndTime - TimeCurrent());
            if(remainingSeconds > 0)
            {
                int remainingMinutes = remainingSeconds / 60;
                int remainingSecs = remainingSeconds % 60;
                displayText += StringFormat("å‰©ä½™: %dåˆ†%dç§’\n", remainingMinutes, remainingSecs);
                displayText += StringFormat("ç»“æŸ: %s\n", TimeToString(sleepEndTime, TIME_DATE|TIME_MINUTES));
            }
        }
        else
        {
            displayText += "æ‰‹åŠ¨ä¼‘çœ ï¼Œéœ€æ‰‹åŠ¨å”¤é†’\n";
        }
        
        displayText += StringFormat("å½“å‰: %s (%s)\n", currentTime, marketSession);
        displayText += StringFormat("ç›˜æ¬¡: %s", nextSession);
    }
    else
    {
        // æ­£å¸¸äº¤æ˜“çŠ¶æ€æ˜¾ç¤º
        displayText += StringFormat("\n--- âœ“ äº¤æ˜“çŠ¶æ€ ---\n");
        displayText += "æ­£å¸¸äº¤æ˜“ä¸­\n";
        displayText += StringFormat("å½“å‰: %s (%s)\n", currentTime, marketSession);
        displayText += StringFormat("ç›˜æ¬¡: %s\n", nextSession);
        
        // ã€æ–°å¢žã€‘æ˜¾ç¤ºä¼‘çœ é¢„è­¦
        if(nextSleepTime > 0)
        {
            int minutesUntilSleep = (int)(nextSleepTime - TimeCurrent()) / 60;
            if(minutesUntilSleep > 0 && minutesUntilSleep <= 60)
            {
                displayText += StringFormat("\nâš  ä¼‘çœ é¢„è­¦ âš \n");
                displayText += StringFormat("%dåˆ†é’ŸåŽå°†å› \n", minutesUntilSleep);
                displayText += StringFormat("%s\n", nextSleepReason);
                displayText += "è¿›å…¥ä¼‘çœ çŠ¶æ€";
            }
        }
    }
    
    Comment(displayText);
}
```

**åŠŸèƒ½è¯´æ˜Žï¼š**
- ä¼‘çœ æ—¶æ˜Žç¡®æ˜¾ç¤º"ã€å½“å‰è½®ç»§ç»­äº¤æ˜“ä¸­ã€‘"
- æ˜¾ç¤ºä¼‘çœ å€’è®¡æ—¶å’Œç»“æŸæ—¶é—´
- æ˜¾ç¤ºå½“å‰å¸‚åœºç›˜å’Œä¸‹æ¬¡ç›˜ä¿¡æ¯
- æ­£å¸¸äº¤æ˜“æ—¶æ˜¾ç¤ºä¼‘çœ é¢„è­¦ï¼ˆ60åˆ†é’Ÿå†…ï¼‰

## ä¸‰ã€ä¿®å¤æ•ˆæžœå¯¹æ¯”

### 3.1 åœºæ™¯å¯¹æ¯”

#### åœºæ™¯1ï¼šä¼‘çœ æ—¶æœ‰æŒä»“

**åŽŸç‰ˆè¡Œä¸ºï¼š**
```
15:00:00 - æ£€æµ‹åˆ°æ¬§æ´²ç›˜å¼€ç›˜å‰æ—¶é—´çª—å£
15:00:00 - è¿›å…¥ä¼‘çœ çŠ¶æ€
15:00:00 - åœæ­¢æ‰€æœ‰äº¤æ˜“é€»è¾‘
15:00:01 - ä»·æ ¼ç»§ç»­æ³¢åŠ¨ï¼Œä½†ä¸åŠ ä»“
15:05:00 - æ»¡è¶³åŠ ä»“æ¡ä»¶ï¼Œä½†ä¸æ‰§è¡Œ
15:10:00 - ä¼‘çœ æ—¶é—´ç»“æŸ
15:10:00 - æ¢å¤äº¤æ˜“ï¼Œä½†å·²é”™è¿‡å¤šä¸ªåŠ ä»“æœºä¼š
```

**ä¿®å¤åŽè¡Œä¸ºï¼š**
```
15:00:00 - æ£€æµ‹åˆ°æ¬§æ´²ç›˜å¼€ç›˜å‰æ—¶é—´çª—å£
15:00:00 - è¿›å…¥ä¼‘çœ çŠ¶æ€
15:00:00 - ã€é‡è¦ã€‘å½“å‰è½®äº¤æ˜“å°†ç»§ç»­æ­£å¸¸æ‰§è¡Œ
15:00:01 - ç»§ç»­è®¡ç®—åŠ ä»“é—´éš”ï¼š150ç‚¹
15:02:30 - ä»·æ ¼æ»¡è¶³åŠ ä»“æ¡ä»¶ï¼Œæ‰§è¡ŒåŠ ä»“
15:03:00 - ç»§ç»­è®¡ç®—ç›ˆåˆ©çŽ‡ç›®æ ‡ï¼š8.5%
15:05:20 - è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡8.6%
15:05:20 - è‡ªåŠ¨å¹³ä»“
15:05:20 - ã€é‡è¦ã€‘ä¿æŒä¼‘çœ çŠ¶æ€ï¼Œä¸å†å¼€å§‹æ–°ä¸€è½®äº¤æ˜“
15:10:00 - ä¼‘çœ æ—¶é—´ç»“æŸ
15:10:00 - æ¢å¤äº¤æ˜“ï¼Œå¯ä»¥å¼€æ–°å•
```

#### åœºæ™¯2ï¼šä¼‘çœ æ—¶æ— æŒä»“

**åŽŸç‰ˆè¡Œä¸ºï¼š**
```
22:00:00 - æ£€æµ‹åˆ°å‘¨äº”æ”¶ç›˜æ—¶é—´
22:00:00 - è¿›å…¥ä¼‘çœ çŠ¶æ€
22:00:00 - æ— æŒä»“
22:00:01 - ä¸å¼€æ–°å•ï¼ˆæ­£ç¡®ï¼‰
å‘¨ä¸€06:30 - ä¼‘çœ ç»“æŸ
å‘¨ä¸€06:30 - æ¢å¤äº¤æ˜“
```

**ä¿®å¤åŽè¡Œä¸ºï¼š**
```
22:00:00 - æ£€æµ‹åˆ°å‘¨äº”æ”¶ç›˜æ—¶é—´
22:00:00 - è¿›å…¥ä¼‘çœ çŠ¶æ€
22:00:00 - æ— æŒä»“ï¼Œç­‰å¾…ä¼‘çœ ç»“æŸ
22:00:01 - ä¸å¼€æ–°å•ï¼ˆæ­£ç¡®ï¼‰
22:00:01 - å›¾è¡¨æ˜¾ç¤º"æ— æŒä»“ï¼Œç­‰å¾…ä¼‘çœ ç»“æŸ"
22:00:01 - æ˜¾ç¤º"å‰©ä½™: 512åˆ†0ç§’"
å‘¨ä¸€06:30 - ä¼‘çœ ç»“æŸ
å‘¨ä¸€06:30 - æ¢å¤äº¤æ˜“
```

### 3.2 åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½é¡¹ | åŽŸç‰ˆv6.141 | ä¿®å¤ç‰ˆv6.141fix | è¯´æ˜Ž |
|--------|------------|-----------------|------|
| ä¼‘çœ æ—¶ç»§ç»­åŠ ä»“ | âŒ ä¸å…è®¸ | âœ… å…è®¸ | å½“å‰è½®ç»§ç»­æ‰§è¡Œ |
| ä¼‘çœ æ—¶è®¡ç®—é—´éš” | âŒ ä¸è®¡ç®— | âœ… è®¡ç®— | å®žæ—¶è®¡ç®—åŠ¨æ€é—´éš” |
| ä¼‘çœ æ—¶è®¡ç®—ç›®æ ‡ | âŒ ä¸è®¡ç®— | âœ… è®¡ç®— | å®žæ—¶è®¡ç®—ç›ˆåˆ©çŽ‡ç›®æ ‡ |
| ä¼‘çœ æ—¶å¹³ä»“ | âŒ ä¸å¹³ä»“ | âœ… è¾¾æ ‡å¹³ä»“ | è¾¾åˆ°ç›®æ ‡è‡ªåŠ¨å¹³ä»“ |
| å¹³ä»“åŽå¼€æ–°å• | âš ï¸ å¯èƒ½å¼€ | âœ… ä¸å¼€ | ä¿æŒä¼‘çœ ï¼Œä¸å¼€æ–°å• |
| ä¼‘çœ é¢„è­¦ | âŒ æ—  | âœ… 60åˆ†é’Ÿé¢„è­¦ | æå‰é¢„è­¦ |
| ç›˜æ¬¡æ˜¾ç¤º | âš ï¸ ç®€å• | âœ… è¯¦ç»† | æ˜¾ç¤ºå½“å‰å’Œä¸‹æ¬¡ç›˜ |
| ä¼‘çœ çŠ¶æ€æ˜¾ç¤º | âš ï¸ ç®€å• | âœ… è¯¦ç»† | æ˜¾ç¤ºå€’è®¡æ—¶å’ŒçŠ¶æ€ |
| å½“å‰è½®çŠ¶æ€ | âŒ æ—  | âœ… æ˜Žç¡®æ˜¾ç¤º | "ã€å½“å‰è½®ç»§ç»­äº¤æ˜“ä¸­ã€‘" |

## å››ã€ä»£ç å®¡æŸ¥æ¸…å•

### 4.1 ä¿®æ”¹ç‚¹æ£€æŸ¥

- [x] OnTickå¼€å¤´ä¼‘çœ æ£€æŸ¥é€»è¾‘
- [x] æ—¶é—´é£Žé™©æŽ§åˆ¶æ£€æŸ¥é€»è¾‘
- [x] æžç«¯è¡Œæƒ…æ£€æµ‹é€»è¾‘
- [x] é©¬ä¸å’Œå¯¹å†²æ‰§è¡Œæ¡ä»¶
- [x] å¹³ä»“åŽå¼€å•é€»è¾‘
- [x] æ–°å¢žä¼‘çœ é¢„è­¦åŠŸèƒ½
- [x] æ–°å¢žäº¤æ˜“ç›˜æ˜¾ç¤ºåŠŸèƒ½
- [x] UpdateDisplayå‡½æ•°å¢žå¼º
- [x] ç‰ˆæœ¬å·æ›´æ–°
- [x] æ—¥å¿—ä¿¡æ¯æ›´æ–°

### 4.2 æµ‹è¯•é¡¹ç›®

**å¿…æµ‹åœºæ™¯ï¼š**
- [ ] ä¼‘çœ å‰æœ‰æŒä»“ï¼Œè§‚å¯Ÿæ˜¯å¦ç»§ç»­åŠ ä»“
- [ ] ä¼‘çœ å‰æœ‰æŒä»“ï¼Œè§‚å¯Ÿè¾¾åˆ°ç›®æ ‡åŽæ˜¯å¦å¹³ä»“
- [ ] ä¼‘çœ æ—¶å¹³ä»“åŽï¼Œè§‚å¯Ÿæ˜¯å¦ä¸å¼€æ–°å•
- [ ] ä¼‘çœ æ—¶æ— æŒä»“ï¼Œè§‚å¯Ÿæ˜¯å¦ä¸å¼€æ–°å•
- [ ] ä¼‘çœ ç»“æŸï¼Œè§‚å¯Ÿæ˜¯å¦è‡ªåŠ¨æ¢å¤äº¤æ˜“
- [ ] æ‰‹åŠ¨ä¼‘çœ ï¼Œè§‚å¯Ÿå½“å‰è½®æ˜¯å¦ç»§ç»­
- [ ] æ‰‹åŠ¨å”¤é†’ï¼Œè§‚å¯Ÿæ˜¯å¦ç«‹å³æ¢å¤
- [ ] ä¼‘çœ é¢„è­¦ï¼Œè§‚å¯Ÿ60åˆ†é’Ÿå‰æ˜¯å¦æ˜¾ç¤º
- [ ] äº¤æ˜“ç›˜æ˜¾ç¤ºï¼Œè§‚å¯Ÿæ˜¯å¦æ­£ç¡®åˆ‡æ¢

**åŽ‹åŠ›æµ‹è¯•ï¼š**
- [ ] å¿«é€Ÿè¿›å‡ºä¼‘çœ çŠ¶æ€
- [ ] å¤šæ¬¡æ‰‹åŠ¨ä¼‘çœ /å”¤é†’
- [ ] ä¼‘çœ æ—¶å¤šæ¬¡åŠ ä»“
- [ ] ä¼‘çœ æ—¶è¾¾åˆ°æœ€å¤§è®¢å•æ•°
- [ ] å‘¨äº”ä¼‘çœ åˆ°å‘¨ä¸€æ¢å¤

### 4.3 å…¼å®¹æ€§æ£€æŸ¥

- [x] æ‰€æœ‰åŽŸç‰ˆå‚æ•°ä¿ç•™
- [x] æ‰€æœ‰åŽŸç‰ˆåŠŸèƒ½ä¿ç•™
- [x] æ—¥å¿—æ ¼å¼å…¼å®¹
- [x] æŒ‰é’®åŠŸèƒ½ä¿ç•™
- [x] å›¾è¡¨æ˜¾ç¤ºå‘ä¸‹å…¼å®¹

## äº”ã€ä½¿ç”¨å»ºè®®

### 5.1 å‚æ•°è®¾ç½®å»ºè®®

**æ—¶é—´æŽ§åˆ¶å‚æ•°ï¼š**
```
EnableTimeControl = true        // å¯ç”¨æ—¶é—´æŽ§åˆ¶
NoWeekendPositions = true       // ä¸ç•™å‘¨æœ«ä»“
EnableMarketTimeControl = true  // å¯ç”¨å¸‚åœºæ—¶é—´èŠ‚ç‚¹æŽ§åˆ¶
```

**å…³é”®æ—¶é—´çª—å£ï¼š**
```
BeforeKeyTimeMinutes = 15  // å…³é”®æ—¶é—´å‰15åˆ†é’Ÿç¦æ­¢å¼€å•
AfterKeyTimeMinutes = 10   // å…³é”®æ—¶é—´åŽ10åˆ†é’Ÿç¦æ­¢å¼€å•
```

è¿™äº›å‚æ•°ç¡®ä¿ç¨‹åºåœ¨å…³é”®æ—¶é—´å‰è¿›å…¥ä¼‘çœ ï¼Œä½†å½“å‰è½®ä¼šç»§ç»­å®Œæˆã€‚

### 5.2 ç›‘æŽ§è¦ç‚¹

**æ—¥å¿—ç›‘æŽ§ï¼š**
- å…³æ³¨"ã€é‡è¦ã€‘"æ ‡è®°çš„æ—¥å¿—
- ç›‘æŽ§ä¼‘çœ è¿›å…¥å’Œç»“æŸæ—¥å¿—
- æ£€æŸ¥åŠ ä»“æ˜¯å¦åœ¨ä¼‘çœ æ—¶ç»§ç»­
- ç¡®è®¤å¹³ä»“åŽä¸å†å¼€æ–°å•

**å›¾è¡¨ç›‘æŽ§ï¼š**
- è§‚å¯Ÿä¼‘çœ çŠ¶æ€æ˜¾ç¤º
- æ£€æŸ¥"ã€å½“å‰è½®ç»§ç»­äº¤æ˜“ä¸­ã€‘"æ ‡è¯†
- ç¡®è®¤ä¼‘çœ é¢„è­¦æ˜¯å¦æå‰æ˜¾ç¤º
- éªŒè¯äº¤æ˜“ç›˜åˆ‡æ¢ä¿¡æ¯

### 5.3 å¸¸è§é—®é¢˜å¤„ç†

**Q1: ä¼‘çœ æ—¶è¿˜åœ¨åŠ ä»“ï¼Œæ˜¯å¦æ­£å¸¸ï¼Ÿ**
A1: å®Œå…¨æ­£å¸¸ï¼è¿™æ˜¯ä¿®å¤åŽçš„æ­£ç¡®è¡Œä¸ºã€‚ä¼‘çœ æ—¶å½“å‰è½®ç»§ç»­ï¼Œç›´åˆ°è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡ã€‚

**Q2: ä¼‘çœ åŽå¤šä¹…å¹³ä»“ï¼Ÿ**
A2: ä¸æ˜¯æ—¶é—´å†³å®šï¼Œè€Œæ˜¯ç›ˆåˆ©ç›®æ ‡å†³å®šã€‚å½“ä¿è¯é‡‘ç›ˆåˆ©çŽ‡è¾¾åˆ°ç›®æ ‡æ—¶è‡ªåŠ¨å¹³ä»“ã€‚

**Q3: å¹³ä»“åŽä¸ºä½•ä¸å¼€æ–°å•ï¼Ÿ**
A3: å› ä¸ºå¤„äºŽä¼‘çœ çŠ¶æ€ã€‚ä¼‘çœ çŠ¶æ€ä¸‹è¾¾åˆ°ç›®æ ‡å¹³ä»“åŽï¼Œä¼šä¿æŒä¼‘çœ ï¼Œä¸å†å¼€æ–°å•ï¼Œç›´åˆ°ä¼‘çœ æ—¶é—´ç»“æŸæˆ–æ‰‹åŠ¨å”¤é†’ã€‚

**Q4: å¦‚ä½•å¿«é€Ÿæ¢å¤äº¤æ˜“ï¼Ÿ**
A4: ç‚¹å‡»"å”¤é†’"æŒ‰é’®å³å¯ç«‹å³è§£é™¤ä¼‘çœ ï¼Œæ¢å¤æ­£å¸¸äº¤æ˜“ã€‚

**Q5: é¢„è­¦åŠŸèƒ½ä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºï¼Ÿ**
A5: è·ç¦»ä¸‹æ¬¡ä¼‘çœ æ—¶é—´60åˆ†é’Ÿä»¥å†…æ—¶ï¼Œä¼šåœ¨å›¾è¡¨ä¸Šæ˜¾ç¤ºé¢„è­¦ä¿¡æ¯ã€‚

## å…­ã€æŠ€æœ¯ç»†èŠ‚

### 6.1 ä¼‘çœ çŠ¶æ€æœº

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ­£å¸¸äº¤æ˜“   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    æ£€æµ‹åˆ°ä¼‘çœ æ¡ä»¶
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”‚   è¿›å…¥ä¼‘çœ    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
           â”‚                                â”‚
    æœ‰æŒä»“â”‚                                â”‚æ— æŒä»“
           â”‚                                â”‚
           â–¼                                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç»§ç»­äº¤æ˜“   â”‚                â”‚   ç­‰å¾…ç»“æŸ   â”‚
    â”‚  å½“å‰è½®æ‰§è¡Œ  â”‚                â”‚   ä¸æ‰§è¡Œé€»è¾‘ â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                â”‚
    è¾¾åˆ°ç›®æ ‡â”‚                                â”‚
           â”‚                                â”‚
           â–¼                                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â”‚   å¹³ä»“æ“ä½œ   â”‚                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
           â”‚                                â”‚
    ä¸å¼€æ–°å•â”‚                                â”‚
           â”‚                                â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
               ä¼‘çœ æ—¶é—´ç»“æŸæˆ–æ‰‹åŠ¨å”¤é†’
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  æ¢å¤äº¤æ˜“   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å…³é”®å˜é‡è¯´æ˜Ž

```cpp
// ä¼‘çœ çŠ¶æ€
bool isSleeping = false;          // æ˜¯å¦å¤„äºŽä¼‘çœ çŠ¶æ€
string sleepReason = "";          // ä¼‘çœ åŽŸå› 
datetime sleepStartTime = 0;      // ä¼‘çœ å¼€å§‹æ—¶é—´
datetime sleepEndTime = 0;        // ä¼‘çœ ç»“æŸæ—¶é—´ï¼ˆ0è¡¨ç¤ºæ‰‹åŠ¨ä¼‘çœ ï¼‰

// æ–°å¢žé¢„è­¦å˜é‡
datetime nextSleepTime = 0;       // ä¸‹æ¬¡ä¼‘çœ æ—¶é—´
string nextSleepReason = "";      // ä¸‹æ¬¡ä¼‘çœ åŽŸå› 

// æŒä»“çŠ¶æ€
int totalOrders = 0;              // æ€»è®¢å•æ•°
bool firstOrderOpened = false;    // æ˜¯å¦å·²å¼€ç¬¬ä¸€å•
```

### 6.3 æ‰§è¡Œæµç¨‹å›¾

```
OnTick()
  â”‚
  â”œâ”€â–º æ£€æŸ¥ä¼‘çœ çŠ¶æ€
  â”‚    â”‚
  â”‚    â”œâ”€â–º ä¼‘çœ ä¸­ && æ— æŒä»“ â†’ return (ä¸æ‰§è¡Œ)
  â”‚    â””â”€â–º ä¼‘çœ ä¸­ && æœ‰æŒä»“ â†’ ç»§ç»­æ‰§è¡Œ
  â”‚
  â”œâ”€â–º æ£€æŸ¥æ—¶é—´é£Žé™©
  â”‚    â””â”€â–º è§¦å‘ä¼‘çœ æ¡ä»¶ â†’ è®¾ç½®isSleeping=true (ä¸return)
  â”‚
  â”œâ”€â–º æ£€æŸ¥æžç«¯è¡Œæƒ…
  â”‚    â””â”€â–º è§¦å‘æžç«¯æ¡ä»¶ â†’ è®¾ç½®isSleeping=true (ä¸return)
  â”‚
  â”œâ”€â–º è®¡æ•°è®¢å•
  â”‚
  â”œâ”€â–º è®¡ç®—ä¸‹æ¬¡ä¼‘çœ æ—¶é—´ (éžä¼‘çœ æ—¶)
  â”‚
  â”œâ”€â–º è‡ªåŠ¨å¼€å•æ£€æŸ¥
  â”‚    â””â”€â–º æ— æŒä»“ && éžä¼‘çœ  â†’ å°è¯•å¼€å•
  â”‚
  â”œâ”€â–º è®¡ç®—ç›ˆåˆ©çŽ‡
  â”‚
  â”œâ”€â–º æ£€æŸ¥æ­¢ç›ˆ
  â”‚    â”‚
  â”‚    â””â”€â–º è¾¾åˆ°ç›®æ ‡
  â”‚         â”‚
  â”‚         â”œâ”€â–º å¹³ä»“
  â”‚         â”‚
  â”‚         â””â”€â–º æ£€æŸ¥ä¼‘çœ çŠ¶æ€
  â”‚              â”‚
  â”‚              â”œâ”€â–º ä¼‘çœ ä¸­ â†’ ä¸å¼€æ–°å•ï¼Œä¿æŒä¼‘çœ 
  â”‚              â””â”€â–º éžä¼‘çœ  â†’ è‡ªåŠ¨å¼€å•
  â”‚
  â””â”€â–º é©¬ä¸å’Œå¯¹å†²é€»è¾‘
       â””â”€â–º æœ‰æŒä»“ â†’ ExecuteStrategy() (ä¸æ£€æŸ¥ä¼‘çœ )
```

## ä¸ƒã€æ€»ç»“

### 7.1 ä¿®å¤æˆæžœ

æœ¬æ¬¡ä¿®å¤å®Œå…¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼š
1. âœ… ä¼‘çœ æ—¶å½“å‰è½®ç»§ç»­æ­£å¸¸æ‰§è¡Œ
2. âœ… æ­£å¸¸è®¡ç®—åŠ ä»“é—´éš”å’Œç›ˆåˆ©çŽ‡ç›®æ ‡
3. âœ… è§¦å‘æ¡ä»¶æ­£å¸¸åŠ ä»“
4. âœ… è¾¾åˆ°ç›®æ ‡åŽå¹³ä»“
5. âœ… å¹³ä»“åŽä¸å†å¼€æ–°å•
6. âœ… ä¼‘çœ æœŸé—´æ³¢åŠ¨çŽ‡è®¡ç®—ç»§ç»­
7. âœ… æ˜¾ç¤ºä¼‘çœ é¢„è­¦
8. âœ… æ˜¾ç¤ºä¼‘çœ çŠ¶æ€è¯¦æƒ…
9. âœ… æ˜¾ç¤ºäº¤æ˜“ç›˜ä¿¡æ¯

### 7.2 ä»£ç è´¨é‡

- âœ… æ— ç¼–è¯‘é”™è¯¯
- âœ… æ— linteré”™è¯¯
- âœ… ä»£ç æ³¨é‡Šå®Œå–„
- âœ… æ—¥å¿—ä¿¡æ¯è¯¦ç»†
- âœ… å‘ä¸‹å…¼å®¹åŽŸç‰ˆ

### 7.3 åŽç»­å»ºè®®

1. **æµ‹è¯•éªŒè¯**
   - åœ¨æ¨¡æ‹Ÿè´¦æˆ·å……åˆ†æµ‹è¯•
   - éªŒè¯å„ç§ä¼‘çœ åœºæ™¯
   - ç¡®è®¤é¢„è­¦åŠŸèƒ½å‡†ç¡®

2. **æ€§èƒ½ç›‘æŽ§**
   - ç›‘æŽ§CPUå ç”¨
   - æ£€æŸ¥å†…å­˜ä½¿ç”¨
   - éªŒè¯æ—¥å¿—æ–‡ä»¶å¤§å°

3. **ç”¨æˆ·åé¦ˆ**
   - æ”¶é›†å®žé™…ä½¿ç”¨åé¦ˆ
   - æ ¹æ®éœ€æ±‚ä¼˜åŒ–æ˜¾ç¤º
   - æŒç»­æ”¹è¿›åŠŸèƒ½

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ20æ—¥  
**ä¿®å¤ç‰ˆæœ¬**: v6.141fix  
**åŸºäºŽç‰ˆæœ¬**: v6.141  
**ä¿®å¤è€…**: AI Assistant  



