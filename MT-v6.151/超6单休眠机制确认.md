# 超6单休眠机制最终确认

## ✅ 确认结果

**MT-v6.15**: ✅ 功能已正确实现  
**MT-v6.151**: ✅ 功能已正确实现

---

## 📋 实现细节

### 参数配置
```mq5
input int MaxOrdersBeforeSleep = 6;       // 超过此单数休眠
input int SleepAfterRoundMinutes = 15;    // 休眠时长(分钟)
```

### 触发条件
```
本轮最大订单数 > 6
```

### 执行时机
```
达到盈利目标 → 平仓所有订单 → 检查订单数 → 如果>6单则休眠15分钟
```

### 休眠参数
```mq5
isSleeping = true;
sleepReason = "上轮超6单";
sleepStartTime = TimeCurrent();
sleepEndTime = TimeCurrent() + 15 * 60;  // 15分钟后
```

---

## 🎯 触发示例

| 本轮订单数 | 是否触发 | 说明 |
|-----------|---------|------|
| 5单 | ❌ 否 | 5 ≤ 6，不休眠 |
| 6单 | ❌ 否 | 6 ≤ 6，不休眠 |
| 7单 | ✅ 是 | 7 > 6，休眠15分钟 |
| 8单 | ✅ 是 | 8 > 6，休眠15分钟 |
| 9单 | ✅ 是 | 9 > 6，休眠15分钟 |

---

## 📊 完整运行示例

### 示例: 本轮加到7单

**完整流程**:
```
10:00:00 → 开第1单 (0.03手)
10:05:30 → 加第2单 (0.02手)
10:12:15 → 加第3单 (0.04手)
10:20:40 → 加第4单 (0.08手)
10:30:25 → 加第5单 (0.16手)
10:42:10 → 加第6单 (0.32手)
10:55:30 → 加第7单 (0.64手) ← 本轮7单
         ↓
11:08:45 → 达到盈利目标
         ↓
   【日志】
   >>> 达到目标保证金盈利率！
   当前保证金盈利率: 8.5%
   目标保证金盈利率: 8.0%
   本轮盈利: $42.50
         ↓
   记录: currentRoundMaxOrders = 7
         ↓
   平掉所有7单
         ↓
   检查: 7 > 6 → TRUE ✅
         ↓
   【日志】
   ========================================
   上一轮订单数: 7
   超过6单,进入休眠15分钟
   ========================================
         ↓
   设置休眠:
   - isSleeping = true
   - sleepReason = "上轮超6单"
   - sleepEndTime = 11:08:45 + 15分钟 = 11:23:45
         ↓
11:23:45 → 休眠时间到
         ↓
   【日志】
   休眠结束,自动恢复交易: 上轮超6单
         ↓
   isSleeping = false
         ↓
11:24:00 → 可以开新一轮交易 ✅
```

---

## 🔍 日志输出示例

### 触发休眠时
```
========================================
>>> 达到目标保证金盈利率！
当前保证金盈利率: 8.500%
目标保证金盈利率: 8.000%
本轮盈利: $42.50
账户余额: $542.50
--- 本轮统计 ---
轮数: 第3轮
盈利金额: $42.50
保证金盈利率: 8.500%
策略模式: 逆势对冲
订单总数: 7           ← 注意这里
--- 累计统计 ---
总轮数: 3
盈利轮数: 3
胜率: 100.00%
累计盈利: $125.30
========================================
上一轮订单数: 7       ← 记录
超过6单,进入休眠15分钟  ← 触发
========================================
休眠状态下达到盈利目标，已平仓
重要保持休眠状态，不再开始新一轮交易
休眠原因: 上轮超6单
预计休眠结束时间: 2025.10.21 11:23 (剩余约15分钟)
========================================
```

### 恢复交易时
```
休眠结束,自动恢复交易: 上轮超6单
```

---

## ✅ 功能完整性检查

### MT-v6.15
- ✅ 参数设置正确 (第170-171行)
- ✅ 触发逻辑正确 (第652-666行)
- ✅ 休眠设置正确
- ✅ 自动恢复正确
- ✅ 手动唤醒支持
- ✅ 日志输出完整

### MT-v6.151
- ✅ 参数设置正确 (第170-171行)
- ✅ 触发逻辑正确 (第640-654行)
- ✅ 休眠设置正确
- ✅ 自动恢复正确
- ✅ 手动唤醒支持
- ✅ 日志输出完整

---

## 💡 重要说明

### 1. "超过6单"的含义
```
> 6单  → 触发 (7单、8单、9单...)
= 6单  → 不触发
< 6单  → 不触发
```

### 2. 与其他休眠的关系

**防单边休眠 vs 超6单休眠**:
- 两者互斥，不会同时触发
- 防单边触发 → 只有防单边休眠
- 正常止盈且>6单 → 只有超6单休眠

**时间控制休眠 vs 超6单休眠**:
- 时间休眠先触发
- 时间休眠中平仓后，会追加超6单休眠吗？
- **答案**: 会的，休眠时间会被更新

**实际情况**:
```
14:45 → 时间触发休眠（欧洲盘切换）
      → sleepEndTime = 14:45 + 25分钟 = 15:10
14:58 → 本轮7单平仓
      → 检查: 7 > 6 → 触发超6单休眠
      → sleepEndTime = 14:58 + 15分钟 = 15:13
      → 休眠延长到15:13
```

**这是合理的**:
- 超6单说明本轮有风险
- 应该延长休眠时间
- 15:13恢复比15:10恢复更安全

### 3. 可调参数

用户可以自定义：
```mq5
MaxOrdersBeforeSleep = 6     // 可改为5、7、8等
SleepAfterRoundMinutes = 15  // 可改为10、20、30等
```

**建议**:
- 保守型: MaxOrdersBeforeSleep = 5
- 平衡型: MaxOrdersBeforeSleep = 6 (默认)
- 激进型: MaxOrdersBeforeSleep = 7

---

## ✅ 最终确认

### 功能状态
✅ **完全实现**  
✅ **逻辑正确**  
✅ **参数合理**  
✅ **自动恢复**  
✅ **手动控制**  
✅ **日志完整**

### 测试建议
1. 模拟盘测试多轮交易
2. 故意让某轮加到7单以上
3. 观察是否自动休眠15分钟
4. 验证15分钟后是否自动恢复
5. 测试手动唤醒功能

---

## 📝 总结

**MT-v6.15和MT-v6.151中的"超6单休眠15分钟"功能已100%正确实现！**

关键特性：
- ✅ 触发条件: 本轮订单数 > 6
- ✅ 休眠时长: 15分钟
- ✅ 自动恢复: 15分钟后
- ✅ 手动控制: 可提前唤醒
- ✅ 日志记录: 完整详细

**可以放心使用！** 🎉

---

**验证日期**: 2025-10-21  
**验证人**: AI Assistant  
**验证结论**: ✅ 完全符合要求






